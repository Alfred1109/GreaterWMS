# GreaterWMS 项目过程文档

## 1. 项目概述

GreaterWMS是一个完全开源的仓库管理系统(Warehouse Management System)，基于福特亚太区售后物流仓储供应链流程开发。该项目采用前后端分离架构，支持多平台访问（Web端、移动端APP、桌面应用）。

### 1.1 项目特点
- **开源免费**: 基于Apache 2.0开源协议
- **多平台支持**: Web、iOS、Android、Desktop全平台覆盖
- **国际化支持**: 支持多语言切换
- **扫码支持**: 支持PDA扫描、手机扫描等多种扫码方式
- **功能完善**: 覆盖仓储管理的全业务流程

### 1.2 技术栈
- **后端**: Python 3.8.10 + Django 4.1.2
- **前端**: Vue.js 2.6.0 + Quasar Framework 1.2.1
- **数据库**: SQLite3（默认）/ MySQL / PostgreSQL
- **消息队列**: Daphne (ASGI)
- **API文档**: Django REST Framework + Swagger
- **移动端**: Cordova
- **桌面端**: Electron

## 2. 项目结构

```
GreaterWMS/
├── app/                    # 移动端应用源码
├── templates/              # 前端源码
├── greaterwms/            # Django主配置
├── media/                 # 媒体文件存储
├── static/                # 静态文件
├── static_new/            # 构建后的静态文件
├── utils/                 # 工具类
├── [业务模块]/             # 各业务模块
│   ├── models.py          # 数据模型
│   ├── views.py           # 视图逻辑
│   ├── serializers.py     # 序列化器
│   ├── urls.py            # URL路由
│   └── admin.py           # 后台管理
├── requirements.txt       # Python依赖
├── manage.py             # Django管理脚本
├── docker-compose.yml    # Docker配置
└── README.md             # 项目说明
```

### 2.1 业务模块结构
- `asn/` - 入库通知模块
- `dn/` - 出库单模块
- `goods/` - 商品管理模块
- `stock/` - 库存管理模块
- `customer/` - 客户管理模块
- `supplier/` - 供应商管理模块
- `warehouse/` - 仓库管理模块
- `binset/` - 货位设置模块
- `cyclecount/` - 盘点模块
- `payment/` - 支付模块
- `staff/` - 员工管理模块
- `userlogin/` - 用户登录模块
- `dashboard/` - 仪表盘模块

## 3. 开发环境搭建

### 3.1 系统要求
- **操作系统**: Windows 10+, macOS 10.15+, Ubuntu 18.04+
- **Python**: 3.8.10+
- **Node.js**: 14.19.3+
- **内存**: 最低4GB RAM
- **磁盘空间**: 最低2GB可用空间

### 3.2 环境安装步骤

#### 步骤1: 安装基础环境
```bash
# 安装Python 3.8.10
# 下载地址: https://www.python.org/downloads/release/python-3810/

# 安装Node.js 14.19.3
# 下载地址: https://nodejs.org/download/release/v14.19.3/

# 安装Git
# 下载地址: https://git-scm.com/downloads
```

#### 步骤2: 克隆项目
```bash
# GitHub源
git clone https://github.com/GreaterWMS/GreaterWMS.git

# 或Gitee源（国内推荐）
git clone https://gitee.com/Singosgu/GreaterWMS.git

cd GreaterWMS
```

#### 步骤3: 后端环境配置
```bash
# 创建虚拟环境
python -m venv venv

# 激活虚拟环境
# Windows:
venv\Scripts\activate
# macOS/Linux:
source venv/bin/activate

# 安装Python依赖
pip install -r requirements.txt

# 数据库迁移
python manage.py makemigrations
python manage.py migrate

# 创建超级用户
python manage.py createsuperuser
```

#### 步骤4: 前端环境配置
```bash
cd templates

# 安装依赖
npm install
# 或使用yarn
yarn install

# 安装Quasar CLI
npm install -g @quasar/cli
```

### 3.3 启动开发服务器

#### 启动后端服务
```bash
# 在项目根目录
daphne -p 8008 greaterwms.asgi:application

# 或局域网访问
daphne -b 0.0.0.0 -p 8008 greaterwms.asgi:application
```

#### 启动前端服务
```bash
cd templates
quasar dev
# 或
quasar d

# 默认访问地址: http://localhost:8080
```

#### 配置API请求地址
修改文件 `templates/public/statics/baseurl.txt`：
```
http://localhost:8008
```

## 4. 开发流程

### 4.1 Git工作流

#### 4.1.1 分支管理策略
- `master` - 主分支，用于生产环境部署
- `develop` - 开发分支，用于集成新功能
- `feature/xxx` - 功能分支，开发新功能
- `hotfix/xxx` - 热修复分支，紧急问题修复
- `release/xxx` - 发布分支，版本发布准备

#### 4.1.2 开发工作流程
```bash
# 1. 从develop分支创建功能分支
git checkout develop
git pull origin develop
git checkout -b feature/new-feature

# 2. 开发功能
# ... 进行开发工作 ...

# 3. 提交代码
git add .
git commit -m "feat: 添加新功能描述"

# 4. 推送到远程仓库
git push origin feature/new-feature

# 5. 创建Pull Request/Merge Request
# 在GitHub/Gitee上创建PR，将功能分支合并到develop

# 6. 代码审查通过后合并
# 删除本地功能分支
git checkout develop
git pull origin develop
git branch -d feature/new-feature
```

### 4.2 代码规范

#### 4.2.1 Python代码规范（PEP8）
```python
# 导入顺序
import os
import sys
from django.db import models
from rest_framework import serializers

# 类命名：大驼峰
class GoodsListModel(models.Model):
    pass

# 函数命名：下划线
def get_goods_list():
    pass

# 常量：全大写
MAX_GOODS_COUNT = 1000
```

#### 4.2.2 JavaScript代码规范（ESLint）
```javascript
// 变量命名：小驼峰
const goodsList = []

// 常量：全大写
const MAX_GOODS_COUNT = 1000

// 函数命名：小驼峰
function getGoodsList() {
  // 实现逻辑
}

// Vue组件：大驼峰
export default {
  name: 'GoodsList'
}
```

### 4.3 API开发规范

#### 4.3.1 RESTful API设计
```python
# urls.py - URL设计规范
urlpatterns = [
    path('goods/', GoodsListView.as_view()),           # GET: 获取商品列表
    path('goods/<int:pk>/', GoodsDetailView.as_view()), # GET: 获取单个商品
    path('goods/create/', GoodsCreateView.as_view()),   # POST: 创建商品
    path('goods/<int:pk>/update/', GoodsUpdateView.as_view()), # PUT: 更新商品
    path('goods/<int:pk>/delete/', GoodsDeleteView.as_view()), # DELETE: 删除商品
]

# views.py - 视图规范
class GoodsListView(generics.ListAPIView):
    """商品列表视图"""
    queryset = ListModel.objects.filter(is_delete=False)
    serializer_class = GoodsListSerializer
    filter_backends = [DjangoFilterBackend]
    filterset_fields = ['goods_code', 'goods_desc', 'supplier']
```

#### 4.3.2 响应格式规范
```json
// 成功响应
{
  "code": 200,
  "message": "success",
  "data": {
    // 具体数据
  }
}

// 错误响应
{
  "code": 400,
  "message": "参数错误",
  "errors": {
    "field": ["错误描述"]
  }
}
```

## 5. 测试流程

### 5.1 单元测试
```python
# tests.py - 测试用例示例
from django.test import TestCase
from .models import ListModel

class GoodsModelTest(TestCase):
    def setUp(self):
        self.goods = ListModel.objects.create(
            goods_code='TEST001',
            goods_desc='测试商品',
            goods_supplier='测试供应商'
        )
    
    def test_goods_creation(self):
        """测试商品创建"""
        self.assertEqual(self.goods.goods_code, 'TEST001')
        self.assertEqual(self.goods.goods_desc, '测试商品')
```

### 5.2 API测试
```bash
# 运行后端测试
python manage.py test

# 运行特定模块测试
python manage.py test goods

# 生成测试覆盖率报告
pip install coverage
coverage run --source='.' manage.py test
coverage report
```

### 5.3 前端测试
```bash
cd templates

# 运行单元测试
npm run test:unit

# 运行端到端测试
npm run test:e2e
```

## 6. 构建和部署

### 6.1 前端构建
```bash
cd templates

# 构建生产版本
quasar build

# 构建结果在 dist/spa/ 目录下
```

### 6.2 Docker部署

#### 6.2.1 使用Docker Compose（推荐）
```bash
# 启动所有服务
docker-compose up -d

# 查看服务状态
docker-compose ps

# 查看日志
docker-compose logs -f

# 停止服务
docker-compose down
```

#### 6.2.2 Docker配置说明
```yaml
# docker-compose.yml
version: '3.8'
services:
  web:
    build: .
    ports:
      - "8008:8008"
    volumes:
      - ./media:/app/media
      - ./static_new:/app/static_new
    environment:
      - DEBUG=False
      - ALLOWED_HOSTS=*
```

### 6.3 传统部署

#### 6.3.1 生产环境配置
```python
# settings.py - 生产环境配置
DEBUG = False
ALLOWED_HOSTS = ['your-domain.com']

# 数据库配置（生产环境建议使用MySQL/PostgreSQL）
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'greaterwms',
        'USER': 'postgres',
        'PASSWORD': 'password',
        'HOST': 'localhost',
        'PORT': '5432',
    }
}
```

#### 6.3.2 Nginx配置示例
```nginx
# nginx.conf
server {
    listen 80;
    server_name your-domain.com;
    
    # 静态文件
    location /static/ {
        alias /path/to/GreaterWMS/static_new/;
    }
    
    location /media/ {
        alias /path/to/GreaterWMS/media/;
    }
    
    # API请求
    location /api/ {
        proxy_pass http://127.0.0.1:8008;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    # 前端页面
    location / {
        root /path/to/GreaterWMS/templates/dist/spa/;
        try_files $uri $uri/ /index.html;
    }
}
```

#### 6.3.3 Supervisor进程管理
```ini
# supervisord.conf
[program:greaterwms]
command=/path/to/venv/bin/daphne -b 0.0.0.0 -p 8008 greaterwms.asgi:application
directory=/path/to/GreaterWMS
user=www-data
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/var/log/greaterwms.log
```

## 7. 移动端开发

### 7.1 Cordova环境配置
```bash
# 安装Cordova
npm install -g cordova

# 进入移动端项目目录
cd app

# 安装依赖
yarn install

# 添加平台
cordova platform add android
cordova platform add ios
```

### 7.2 移动端开发流程
```bash
# 开发模式（热重载）
quasar dev -m cordova -T android

# 构建APK
quasar build -m cordova -T android

# 构建iOS应用（需要macOS环境）
quasar build -m cordova -T ios
```

## 8. 质量保证

### 8.1 代码审查清单
- [ ] 代码符合项目编码规范
- [ ] 没有语法错误和运行时错误
- [ ] 功能实现符合需求
- [ ] 有适当的注释和文档
- [ ] 单元测试覆盖关键逻辑
- [ ] 没有明显的性能问题
- [ ] 安全性考虑到位

### 8.2 发布前检查
- [ ] 所有测试用例通过
- [ ] 代码已合并到主分支
- [ ] 数据库迁移文件已创建
- [ ] 配置文件已更新
- [ ] 文档已更新
- [ ] 版本号已更新

### 8.3 监控和维护
- **性能监控**: 使用Django Debug Toolbar监控SQL查询
- **错误监控**: 配置日志记录和错误报告
- **安全更新**: 定期更新依赖包和安全补丁
- **数据备份**: 建立定期备份机制

## 9. 常见问题和解决方案

### 9.1 开发环境问题

#### 问题1: Twisted安装失败
**解决方案**:
```bash
# Windows环境
pip install --upgrade setuptools
pip install twisted

# 或下载预编译包
pip install https://download.lfd.uci.edu/pythonlibs/archived/Twisted-...-.whl
```

#### 问题2: Node.js版本兼容性
**解决方案**:
```bash
# 使用nvm管理Node.js版本
nvm install 14.19.3
nvm use 14.19.3
```

### 9.2 部署问题

#### 问题1: 静态文件404
**解决方案**:
```bash
# 收集静态文件
python manage.py collectstatic

# 检查Nginx配置
nginx -t
nginx -s reload
```

#### 问题2: WebSocket连接失败
**解决方案**:
```nginx
# Nginx WebSocket配置
location /ws/ {
    proxy_pass http://127.0.0.1:8008;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
}
```

## 10. 版本历史

### v2.1.48 (当前版本)
- 支持Django 4.1.2
- 增强API文档
- 优化移动端体验
- 修复已知问题

### 后续计划
- 支持微服务架构
- 增加更多第三方集成
- 优化性能和用户体验
- 增强安全性

## 11. 参与贡献

### 11.1 贡献方式
1. Fork项目到个人仓库
2. 创建功能分支进行开发
3. 提交Pull Request
4. 等待代码审查和合并

### 11.2 贡献指南
- 遵循项目代码规范
- 提供完整的测试用例
- 编写清晰的提交信息
- 更新相关文档

### 11.3 社区支持
- **QQ技术交流群**: 289548524
- **官网**: https://www.56yhz.com/
- **演示地址**: https://production.56yhz.com/
- **视频教程**: https://space.bilibili.com/407321291

---

*文档版本: 1.0*  
*最后更新: 2024年*  
*维护者: GreaterWMS开发团队*
