# GreaterWMS 数据库说明文档

## 1. 项目概述

GreaterWMS是一个完全开源的仓库管理系统，采用Django后端 + Vue.js前端的架构。该系统基于福特亚太区售后物流仓储供应链流程开发，支持多种平台（网页端、移动端APP、桌面应用等）。

## 2. 技术架构

- **后端框架**: Django 4.1.2
- **前端框架**: Vue.js 2.6.0 + Quasar 1.2.1
- **数据库**: SQLite3（默认，支持其他数据库）
- **API**: Django REST Framework
- **认证**: JWT认证
- **文档**: Swagger API文档
- **部署**: 支持Docker部署

## 3. 数据库配置

```python
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
        'OPTIONS': {
            'timeout': 20,
        }
    }
}
```

## 4. 核心数据表结构

### 4.1 商品管理模块

#### 4.1.1 商品主表 (goods)
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BigAutoField | 主键ID |
| goods_code | CharField(255) | 商品代码 |
| goods_desc | CharField(255) | 商品描述 |
| goods_supplier | CharField(255) | 商品供应商 |
| goods_weight | FloatField | 商品重量 |
| goods_w | FloatField | 商品宽度 |
| goods_d | FloatField | 商品深度 |
| goods_h | FloatField | 商品高度 |
| unit_volume | FloatField | 单位体积 |
| goods_unit | CharField(255) | 商品单位 |
| goods_class | CharField(255) | 商品类别 |
| goods_brand | CharField(255) | 商品品牌 |
| goods_color | CharField(255) | 商品颜色 |
| goods_shape | CharField(255) | 商品形状 |
| goods_specs | CharField(255) | 商品规格 |
| goods_origin | CharField(255) | 商品产地 |
| safety_stock | BigIntegerField | 安全库存 |
| goods_cost | FloatField | 商品成本 |
| goods_price | FloatField | 商品价格 |
| bar_code | CharField(255) | 条形码 |
| creater | CharField(255) | 创建人 |
| openid | CharField(255) | 用户标识 |
| is_delete | BooleanField | 删除标志 |
| create_time | DateTimeField | 创建时间 |
| update_time | DateTimeField | 更新时间 |

### 4.2 库存管理模块

#### 4.2.1 库存主表 (stocklist)
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BigAutoField | 主键ID |
| goods_code | CharField(255) | 商品代码 |
| goods_desc | CharField(255) | 商品描述 |
| goods_qty | BigIntegerField | 总数量 |
| onhand_stock | BigIntegerField | 现有库存 |
| can_order_stock | BigIntegerField | 可订购库存 |
| ordered_stock | BigIntegerField | 已订购库存 |
| inspect_stock | BigIntegerField | 检验库存 |
| hold_stock | BigIntegerField | 保留库存 |
| damage_stock | BigIntegerField | 损坏库存 |
| asn_stock | BigIntegerField | ASN库存 |
| dn_stock | BigIntegerField | DN库存 |
| pre_load_stock | BigIntegerField | 预装载库存 |
| pre_sort_stock | BigIntegerField | 预分拣库存 |
| sorted_stock | BigIntegerField | 已分拣库存 |
| pick_stock | BigIntegerField | 拣货库存 |
| picked_stock | BigIntegerField | 已拣货库存 |
| back_order_stock | BigIntegerField | 欠货库存 |
| supplier | CharField(255) | 供应商 |
| openid | CharField(255) | 用户标识 |
| create_time | DateTimeField | 创建时间 |
| update_time | DateTimeField | 更新时间 |

#### 4.2.2 货位库存表 (stockbin)
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BigAutoField | 主键ID |
| bin_name | CharField(255) | 货位名称 |
| goods_code | CharField(255) | 商品代码 |
| goods_desc | CharField(255) | 商品描述 |
| goods_qty | BigIntegerField | 货位库存数量 |
| pick_qty | BigIntegerField | 拣货数量 |
| picked_qty | BigIntegerField | 已拣数量 |
| bin_size | CharField(255) | 货位尺寸 |
| bin_property | CharField(255) | 货位属性 |
| t_code | CharField(255) | 事务代码 |
| openid | CharField(255) | 用户标识 |
| create_time | DateTimeField | 创建时间 |
| update_time | DateTimeField | 更新时间 |

### 4.3 入库管理模块 (ASN - Advance Shipping Notice)

#### 4.3.1 入库通知主表 (asnlist)
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BigAutoField | 主键ID |
| asn_code | CharField(255) | ASN代码 |
| asn_status | BigIntegerField | ASN状态 |
| total_weight | FloatField | 总重量 |
| total_volume | FloatField | 总体积 |
| total_cost | FloatField | 总成本 |
| supplier | CharField(255) | 供应商 |
| transportation_fee | JSONField | 运输费用 |
| creater | CharField(255) | 创建人 |
| bar_code | CharField(255) | 条形码 |
| openid | CharField(255) | 用户标识 |
| is_delete | BooleanField | 删除标志 |
| create_time | DateTimeField | 创建时间 |
| update_time | DateTimeField | 更新时间 |

#### 4.3.2 入库通知明细表 (asndetail)
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BigAutoField | 主键ID |
| asn_code | CharField(255) | ASN代码 |
| asn_status | BigIntegerField | ASN状态 |
| supplier | CharField(255) | 供应商 |
| goods_code | CharField(255) | 商品代码 |
| goods_desc | CharField(255) | 商品描述 |
| goods_qty | BigIntegerField | 商品数量 |
| goods_actual_qty | BigIntegerField | 实际数量 |
| sorted_qty | BigIntegerField | 已分拣数量 |
| goods_shortage_qty | BigIntegerField | 短缺数量 |
| goods_more_qty | BigIntegerField | 溢出数量 |
| goods_damage_qty | BigIntegerField | 损坏数量 |
| goods_weight | FloatField | 商品重量 |
| goods_volume | FloatField | 商品体积 |
| goods_cost | FloatField | 商品成本 |
| creater | CharField(255) | 创建人 |
| openid | CharField(255) | 用户标识 |
| is_delete | BooleanField | 删除标志 |
| create_time | DateTimeField | 创建时间 |
| update_time | DateTimeField | 更新时间 |

### 4.4 出库管理模块 (DN - Delivery Note)

#### 4.4.1 出库单主表 (dnlist)
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BigAutoField | 主键ID |
| dn_code | CharField(255) | DN代码 |
| dn_status | BigIntegerField | DN状态 |
| total_weight | FloatField | 总重量 |
| total_volume | FloatField | 总体积 |
| total_cost | FloatField | 总成本 |
| customer | CharField(255) | 客户 |
| transportation_fee | JSONField | 运输费用 |
| back_order_label | BooleanField | 缺货标志 |
| creater | CharField(255) | 创建人 |
| bar_code | CharField(255) | 条形码 |
| openid | CharField(255) | 用户标识 |
| is_delete | BooleanField | 删除标志 |
| create_time | DateTimeField | 创建时间 |
| update_time | DateTimeField | 更新时间 |

#### 4.4.2 出库单明细表 (dndetail)
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BigAutoField | 主键ID |
| dn_code | CharField(255) | DN代码 |
| dn_status | BigIntegerField | DN状态 |
| customer | CharField(255) | 客户 |
| goods_code | CharField(255) | 商品代码 |
| goods_desc | CharField(255) | 商品描述 |
| goods_qty | BigIntegerField | 商品数量 |
| pick_qty | BigIntegerField | 拣货数量 |
| picked_qty | BigIntegerField | 已拣数量 |
| intransit_qty | BigIntegerField | 在途数量 |
| delivery_actual_qty | BigIntegerField | 实际交付数量 |
| delivery_shortage_qty | BigIntegerField | 交付短缺数量 |
| delivery_more_qty | BigIntegerField | 交付溢出数量 |
| delivery_damage_qty | BigIntegerField | 交付损坏数量 |
| goods_weight | FloatField | 商品重量 |
| goods_volume | FloatField | 商品体积 |
| goods_cost | FloatField | 商品成本 |
| back_order_label | BooleanField | 缺货标志 |
| creater | CharField(255) | 创建人 |
| openid | CharField(255) | 用户标识 |
| is_delete | BooleanField | 删除标志 |
| create_time | DateTimeField | 创建时间 |
| update_time | DateTimeField | 更新时间 |

#### 4.4.3 拣货单表 (pickinglist)
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BigAutoField | 主键ID |
| dn_code | CharField(255) | DN代码 |
| bin_name | CharField(255) | 货位名称 |
| goods_code | CharField(255) | 商品代码 |
| picking_status | SmallIntegerField | 拣货状态 |
| pick_qty | BigIntegerField | 拣货数量 |
| picked_qty | BigIntegerField | 已拣数量 |
| t_code | CharField(255) | 事务代码 |
| creater | CharField(255) | 创建人 |
| openid | CharField(255) | 用户标识 |
| create_time | DateTimeField | 创建时间 |
| update_time | DateTimeField | 更新时间 |

### 4.5 基础数据模块

#### 4.5.1 客户表 (customer)
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BigAutoField | 主键ID |
| customer_name | CharField(255) | 客户名称 |
| customer_city | CharField(255) | 客户城市 |
| customer_address | CharField(255) | 客户地址 |
| customer_contact | CharField(255) | 客户联系方式 |
| customer_manager | CharField(255) | 客户经理 |
| customer_level | BigIntegerField | 客户等级 |
| creater | CharField(255) | 创建人 |
| openid | CharField(255) | 用户标识 |
| is_delete | BooleanField | 删除标志 |
| create_time | DateTimeField | 创建时间 |
| update_time | DateTimeField | 更新时间 |

#### 4.5.2 供应商表 (supplier)
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BigAutoField | 主键ID |
| supplier_name | CharField(255) | 供应商名称 |
| supplier_city | CharField(255) | 供应商城市 |
| supplier_address | CharField(255) | 供应商地址 |
| supplier_contact | CharField(255) | 供应商联系方式 |
| supplier_manager | CharField(255) | 供应商经理 |
| supplier_level | BigIntegerField | 供应商等级 |
| creater | CharField(255) | 创建人 |
| openid | CharField(255) | 用户标识 |
| is_delete | BooleanField | 删除标志 |
| create_time | DateTimeField | 创建时间 |
| update_time | DateTimeField | 更新时间 |

#### 4.5.3 仓库表 (warehouse)
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BigAutoField | 主键ID |
| warehouse_name | CharField(255) | 仓库名称 |
| warehouse_city | CharField(255) | 仓库城市 |
| warehouse_address | CharField(255) | 仓库地址 |
| warehouse_contact | CharField(255) | 仓库联系方式 |
| warehouse_manager | CharField(255) | 仓库经理 |
| creater | CharField(255) | 创建人 |
| openid | CharField(255) | 用户标识 |
| is_delete | BooleanField | 删除标志 |
| create_time | DateTimeField | 创建时间 |
| update_time | DateTimeField | 更新时间 |

#### 4.5.4 货位设置表 (binset)
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BigAutoField | 主键ID |
| bin_name | CharField(255) | 货位名称 |
| bin_size | CharField(255) | 货位尺寸 |
| bin_property | CharField(11) | 货位属性 |
| empty_label | BooleanField | 空位标志 |
| bar_code | CharField(255) | 条形码 |
| creater | CharField(255) | 创建人 |
| openid | CharField(255) | 用户标识 |
| is_delete | BooleanField | 删除标志 |
| create_time | DateTimeField | 创建时间 |
| update_time | DateTimeField | 更新时间 |

## 5. 数据库关系说明

### 5.1 主要业务关系
- **商品 -> 库存**: 一对一关系，每个商品对应一条库存记录
- **库存 -> 货位库存**: 一对多关系，一个商品可以存放在多个货位
- **ASN -> ASN明细**: 一对多关系，一个入库通知包含多个商品明细
- **DN -> DN明细**: 一对多关系，一个出库单包含多个商品明细
- **DN -> 拣货单**: 一对多关系，一个出库单生成多条拣货任务

### 5.2 基础数据关系
- **供应商 -> 商品**: 一对多关系，一个供应商可提供多个商品
- **客户 -> 出库单**: 一对多关系，一个客户可有多个出库单
- **货位 -> 货位库存**: 一对多关系，一个货位可存放多种商品

## 6. 业务流程数据流

### 6.1 入库流程
1. 创建入库通知(ASN) -> `asnlist`
2. 添加入库商品明细 -> `asndetail`
3. 收货确认，更新实际数量 -> `asndetail.goods_actual_qty`
4. 上架，更新库存 -> `stocklist`, `stockbin`

### 6.2 出库流程
1. 创建出库单(DN) -> `dnlist`
2. 添加出库商品明细 -> `dndetail`
3. 生成拣货任务 -> `pickinglist`
4. 执行拣货，更新拣货数量 -> `pickinglist.picked_qty`
5. 确认出库，更新库存 -> `stocklist`, `stockbin`

### 6.3 库存状态管理
系统维护多种库存状态，包括：
- 现有库存 (`onhand_stock`)
- 可订购库存 (`can_order_stock`)
- 已订购库存 (`ordered_stock`)
- 检验库存 (`inspect_stock`)
- 保留库存 (`hold_stock`)
- 损坏库存 (`damage_stock`)

## 7. 索引建议

为了提高查询性能，建议在以下字段上创建索引：

```sql
-- 商品表
CREATE INDEX idx_goods_code ON goods(goods_code);
CREATE INDEX idx_goods_supplier ON goods(goods_supplier);
CREATE INDEX idx_goods_openid ON goods(openid);

-- 库存表
CREATE INDEX idx_stock_goods_code ON stocklist(goods_code);
CREATE INDEX idx_stock_openid ON stocklist(openid);
CREATE INDEX idx_stockbin_bin_name ON stockbin(bin_name);
CREATE INDEX idx_stockbin_goods_code ON stockbin(goods_code);

-- ASN表
CREATE INDEX idx_asn_code ON asnlist(asn_code);
CREATE INDEX idx_asn_supplier ON asnlist(supplier);
CREATE INDEX idx_asndetail_asn_code ON asndetail(asn_code);
CREATE INDEX idx_asndetail_goods_code ON asndetail(goods_code);

-- DN表
CREATE INDEX idx_dn_code ON dnlist(dn_code);
CREATE INDEX idx_dn_customer ON dnlist(customer);
CREATE INDEX idx_dndetail_dn_code ON dndetail(dn_code);
CREATE INDEX idx_dndetail_goods_code ON dndetail(goods_code);
CREATE INDEX idx_picking_dn_code ON pickinglist(dn_code);
```

## 8. 数据备份建议

- **定期备份**: 建议每日凌晨进行全量备份
- **增量备份**: 可选择每小时进行增量备份
- **备份验证**: 定期验证备份文件的完整性
- **异地存储**: 将备份文件存储到异地或云端

## 9. 扩展性考虑

- **分库分表**: 当数据量增长时，可考虑按仓库或时间进行分表
- **读写分离**: 可配置主从数据库实现读写分离
- **数据归档**: 定期归档历史数据，保持主库性能
- **缓存策略**: 使用Redis缓存热点数据

---

*文档版本: 1.0*  
*最后更新: 2024年*  
*维护者: GreaterWMS开发团队*
